#MsgBus设计说明
---

##MsgBus解决了什么问题

MsgBus是保证信息能从源服务器发送到目标服务器的而设计的，是服务器内部集群消息传递的基础.

---

##MsgBus的一些概念

1. MsgBus本身是无状态服务器，状态的读取依赖NameServer后台的Redis服务器
2. MsgBus只负责读取Redis的状态
3. MsgBus负责两类消息的传递
	* 点对点的不需要回应的消息
	* 点对点需要回应的消息
	* 点对多的广播类消息
4. MsgBus需要从协议层区分这三类消息


##MsgBus的设计

1. TCP协议，长连接，心跳检测
2. LVS保证后台多个MsgBus的Load Balance
3. 消息格式要体现源地址，目标地址，是否需要回应等字段
4. MsgBus需要跟Zookeeper服务器监听，得到最新的所有服务器列表信息
5. 当消息无法投递时（例如目标服务器已经宕机），需要有错误码回应给源服务器
6. 支持多个端口监听

##Msg的统计和监控信息

1. 投递了多少消息
2. 投递了多少广播消息
3. 投递了多少点对点消息
4. 多少失败的消息
5. 当前连接了多少台服务器
6. 机器状态和版本和配置文件信息
7. gc的状态和routine信息